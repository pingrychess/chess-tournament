<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CB Newton Cup Leaderboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .leaderboard-table th {
            background: #2563eb;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .leaderboard-table td {
            padding: 12px;
            border-top: 1px solid #e2e8f0;
        }
        .leaderboard-table tr:nth-child(even) {
            background: #f8fafc;
        }
        .win { color: #059669; }
        .loss { color: #dc2626; }
        .recent-results {
            display: flex;
            gap: 8px;
        }
        .result-badge {
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.875rem;
        }
        .win-badge {
            background: #dcfce7;
            color: #059669;
        }
        .loss-badge {
            background: #fee2e2;
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-8">CB Newton Cup Leaderboard</h1>
            <div id="leaderboard" class="relative overflow-x-auto shadow-md rounded-lg">
                <!-- Leaderboard will be populated here -->
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Student Name</th>
                            <th>Record</th>
                            <th>Recent Results</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <tr>
                            <td colspan="4" class="text-center py-4">Loading leaderboard data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Replace with your Google Sheet ID
        const SHEET_ID = '1dii9ZYNG25xDr2ShnEYLfQ_FvlIPruhc4IxoYJUVXF4';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

        function createResultBadge(result) {
            const badge = document.createElement('span');
            badge.className = `result-badge ${result === 'W' ? 'win-badge' : 'loss-badge'}`;
            badge.textContent = result;
            return badge;
        }

        async function updateLeaderboard() {
            try {
                const response = await fetch(SHEET_URL);
                const text = await response.text();
                const data = JSON.parse(text.substring(47).slice(0, -2));

                const tbody = document.getElementById('leaderboard-body');
                tbody.innerHTML = '';

                data.table.rows.forEach(row => {
                    const tr = document.createElement('tr');

                    // Rank
                    const rankTd = document.createElement('td');
                    rankTd.textContent = row.c[0]?.v || '';

                    // Name
                    const nameTd = document.createElement('td');
                    nameTd.textContent = row.c[1]?.v || '';

                    // Record
                    const recordTd = document.createElement('td');
                    recordTd.textContent = row.c[2]?.v || '';

                    // Recent Results
                    const resultsTd = document.createElement('td');
                    const resultsDiv = document.createElement('div');
                    resultsDiv.className = 'recent-results';

                    // Add the three most recent results
                    for (let i = 3; i <= 5; i++) {
                        if (row.c[i]?.v) {
                            resultsDiv.appendChild(createResultBadge(row.c[i].v));
                        }
                    }

                    resultsTd.appendChild(resultsDiv);

                    tr.appendChild(rankTd);
                    tr.appendChild(nameTd);
                    tr.appendChild(recordTd);
                    tr.appendChild(resultsTd);

                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
                document.getElementById('leaderboard-body').innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center py-4 text-red-600">
                            Error loading leaderboard data. Please try again later.
                        </td>
                    </tr>
                `;
            }
        }

        // Update immediately and then every 5 minutes
        updateLeaderboard();
        setInterval(updateLeaderboard, 300000);
    </script>
</body>
</html>
